"use strict";exports.__esModule=true;;var SHORTCUTS_MODULES=["ctrl","shift","alt","meta"];var KeyboardShortcut=(function(){function KeyboardShortcut(){this._D=document.body;this._listeners={};this._keydownHandler=this._keydownHandler.bind(this);}
KeyboardShortcut.prototype._keydownHandler=function(e){var code=(e.code||e.key),keyCode=code.substring(code.startsWith("Key")?3:0),keys=[],filter=[16,17,18,91,93];e.ctrlKey&&keys.push('ctrl');e.shiftKey&&keys.push('shift');e.altKey&&keys.push('alt');e.metaKey&&keys.push('meta');if(filter.filter(function(n){return n===e.keyCode;}).length==0)
keys.push(keyCode.toLowerCase());var k=keys.join("+"),l=this._listeners[k];if(l){e.hotKeys=k;l(e),l.propagate&&e.stopPropagation(),e.preventDefault();}};KeyboardShortcut.prototype.getHotKeys=function(){var len=arguments.length,ar=arguments,t=this;var el=this._D,call,isDone=false,sequence={};if(len===2){el=ar[0],call=ar[1];}
else if(typeof(ar[0])==='function'){call=ar[0];}
var element=this._element(el),hotKeys={code:''};var hotKeysHandler=function(e){var _a;var type=e.type,ev=e;if("keydown"===type){isDone=false,hotKeys.alt=e.altKey,hotKeys.shift=e.shiftKey,hotKeys.ctrl=e.ctrlKey,hotKeys.meta=e.metaKey,hotKeys.keyCode=e.keyCode,hotKeys.code=e.code.substring(e.code.startsWith("Key")?3:0);SHORTCUTS_MODULES.map(function(k){if(ev[k+'Key']&&!(k in sequence))
sequence[k]=Object.keys(sequence).length;});}
else if("keyup"===type){if(Object.keys(sequence).length==0)
return;if(isDone){doneFunc();console.log("新快捷热键为:",(_a=hotKeys.keys)===null||_a===void 0?void 0:_a.join(" + ")),sequence={};return;}
isDone=true;}};var doneFunc=function(){hotKeys.keys=Object.keys(sequence).concat(hotKeys.code);var ok=call(hotKeys);if(ok){t._removeEvent(element,"keydown",hotKeysHandler);t._removeEvent(element,"keyup",hotKeysHandler);}};return this._addEvent(element,"keydown",hotKeysHandler)._addEvent(element,"keyup",hotKeysHandler);};KeyboardShortcut.prototype.on=function(){var len=arguments.length,ar=arguments;var el,keys,l,propagate=false;if(len===4){el=ar[0],keys=ar[1],l=ar[2],propagate=ar[3];}
else if(len===3&&typeof(ar[len-1])==='function'){el=ar[0],keys=ar[1],l=ar[2];}
else if(len===3){el=this._D,keys=ar[0],l=ar[1],propagate=ar[2];}
else{el=this._D,keys=ar[0],l=ar[1];}
return this._bind(el,keys,l,propagate,false);};KeyboardShortcut.prototype.once=function(){var len=arguments.length,ar=arguments;var el,keys,l,propagate=false;if(len===4){el=ar[0],keys=ar[1],l=ar[2],propagate=ar[3];}
else if(len===3&&typeof(ar[len-1])==='function'){el=ar[0],keys=ar[1],l=ar[2];}
else if(len===3){el=this._D,keys=ar[0],l=ar[1],propagate=ar[2];}
else{el=this._D,keys=ar[0],l=ar[1];}
return this._bind(el,keys,l,propagate,true);};KeyboardShortcut.prototype.off=function(p){var t=typeof p,s=t==='string';var el;if(s){if(p.indexOf("+")>0){el=document.querySelector("[aria-keyshortcuts='"+p+"']");}
else{el=document.querySelector(p);}}
else{if("tagName"in p){el=p;}
else{p=this._compose(p);el=document.querySelector("[aria-keyshortcuts='"+p+"']");}}
if(el){var keys=el.getAttribute("aria-keyshortcuts");this._removeEvent(el,"keydown",this._keydownHandler);delete this._listeners[keys];}
return this;};KeyboardShortcut.prototype._addEvent=function(el,type,l,once){el===null||el===void 0?void 0:el.addEventListener(type,l,{capture:false,once:once});return this;};KeyboardShortcut.prototype._removeEvent=function(el,type,l){el===null||el===void 0?void 0:el.removeEventListener(type,l,false);el===null||el===void 0?void 0:el.removeAttribute("aria-keyshortcuts");return this;};KeyboardShortcut.prototype._bind=function(el,keys,l,propagate,once){var ks=this._compose(keys),element=this._element(el);this._listeners[ks]=l;this._listeners[ks].propagate=propagate;once==false&&element.setAttribute("aria-keyshortcuts",ks);this._addEvent(element,"keydown",this._keydownHandler,once);return this;};KeyboardShortcut.prototype._compose=function(keys){var k;if(typeof(keys)==="string"){var ar=keys.split('+');k={code:ar[ar.length-1]};SHORTCUTS_MODULES.map(function(s){k[s]=keys.indexOf(s)!=-1;});}
else{k=keys;}
var h=[];k.ctrl&&h.push('ctrl');k.shift&&h.push('shift');k.alt&&h.push('alt');k.meta&&h.push('meta');h.push(k.code.toLowerCase());return h.join("+");};KeyboardShortcut.prototype._element=function(el){return typeof(el)==="string"?document.querySelector(el):el;};return KeyboardShortcut;}());var ShortcutJs=new KeyboardShortcut();if(typeof window!=="undefined")
window.shortcutJs=ShortcutJs;exports["default"]=ShortcutJs;